<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Assistant</title>
    <style>
        :root { --bg: #0f172a; --primary: #38bdf8; --text: #f1f5f9; --chat-bg: #1e293b; }
        body, html { height: 100%; margin: 0; background: var(--bg); color: var(--text); font-family: sans-serif; overflow: hidden; }
        
        .chat-wrapper { display: flex; flex-direction: column; height: 100vh; }
        header { padding: 1rem; border-bottom: 1px solid #334155; display: flex; align-items: center; justify-content: space-between; }
        header a { color: var(--primary); text-decoration: none; font-size: 0.9rem; font-weight: bold; }

        #chat-content { flex: 1; overflow-y: auto; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; }
        .bubble { padding: 0.8rem 1.2rem; border-radius: 15px; font-size: 0.95rem; line-height: 1.5; max-width: 85%; }
        .user { align-self: flex-end; background: var(--primary); color: #0f172a; border-bottom-right-radius: 2px; }
        .ai { align-self: flex-start; background: var(--chat-bg); border: 1px solid #334155; border-bottom-left-radius: 2px; }

        .input-area { padding: 1rem; background: var(--bg); border-top: 1px solid #334155; }
        .input-box { max-width: 800px; margin: 0 auto; display: flex; background: var(--chat-bg); padding: 0.5rem; border-radius: 12px; border: 1px solid #444; }
        input { flex: 1; background: transparent; border: none; color: white; padding: 0.6rem; outline: none; font-size: 1rem; width: 100%; }
        button { background: var(--primary); border: none; padding: 0.6rem 1.2rem; border-radius: 8px; font-weight: bold; cursor: pointer; }

        @media (max-width: 480px) {
            #chat-content { padding: 1rem; }
            .bubble { max-width: 90%; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="chat-wrapper">
        <header>
            <a href="index.html">‚Üê Portofolio</a>
            <span style="font-weight:bold; font-size:0.9rem;">Llama 3.3 Assistant</span>
            <div style="width:50px"></div>
        </header>

        <div id="chat-content">
            <div class="bubble ai">Halo! Saya asisten AI Anda. Ada yang bisa saya bantu hari ini?</div>
        </div>

        <div class="input-area">
            <div class="input-box">
                <input type="text" id="userInput" placeholder="Tulis pesan..." autocomplete="off">
                <button onclick="askAI()">Kirim</button>
            </div>
        </div>
    </div>

    <script>
        async function askAI() {
            const input = document.getElementById('userInput');
            const content = document.getElementById('chat-content');
            const val = input.value.trim();
            if(!val) return;

            content.innerHTML += `<div class="bubble user">${val}</div>`;
            input.value = '';
            
            const loadId = "ai-" + Date.now();
            content.innerHTML += `<div class="bubble ai" id="${loadId}">Mengetik...</div>`;
            content.scrollTop = content.scrollHeight;

            try {
                const res = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: [{role: "user", content: val}] })
                });
                const data = await res.json();
                document.getElementById(loadId).innerText = data.reply;
            } catch (e) {
                document.getElementById(loadId).innerText = "Error koneksi server.";
            }
            content.scrollTop = content.scrollHeight;
        }

        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') askAI();
        });
    </script>
</body>
</html>
